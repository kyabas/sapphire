<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Processing of HiSPARC traces &mdash; SAPPHiRE 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/hisparc_style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="SAPPHiRE 1.0.0 documentation" href="../index.html" />
    <link rel="up" title="Data analysis" href="../analysis.html" />
    <link rel="next" title="Reconstructions" href="reconstructions.html" />
    <link rel="prev" title="Processing of HiSPARC events" href="process_events.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="reconstructions.html" title="Reconstructions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="process_events.html" title="Processing of HiSPARC events"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SAPPHiRE 1.0.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../sapphire.html" >SAPPHiRE Reference</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../analysis.html" accesskey="U">Data analysis</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-sapphire.analysis.process_traces">
<span id="processing-of-hisparc-traces"></span><h1>Processing of HiSPARC traces<a class="headerlink" href="#module-sapphire.analysis.process_traces" title="Permalink to this headline">¶</a></h1>
<p>Process HiSPARC traces</p>
<p>This module can be used analyse (raw) traces. It implements the same
algorithms as are implemented in the HiSPARC DAQ.</p>
<p>The <a class="reference internal" href="#sapphire.analysis.process_traces.MeanFilter" title="sapphire.analysis.process_traces.MeanFilter"><code class="xref py py-class docutils literal"><span class="pre">MeanFilter</span></code></a> is meant to mimic the filter in the HiSPARC DAQ.
It is reproduced here to make it easy to read the algorithm.</p>
<dl class="data">
<dt id="sapphire.analysis.process_traces.PRE_TRIGGER">
<code class="descclassname">sapphire.analysis.process_traces.</code><code class="descname">PRE_TRIGGER</code><em class="property"> = 400</em><a class="headerlink" href="#sapphire.analysis.process_traces.PRE_TRIGGER" title="Permalink to this definition">¶</a></dt>
<dd><p>Default pre trigger window, i.e. 1000 ns</p>
</dd></dl>

<dl class="data">
<dt id="sapphire.analysis.process_traces.TRIGGER">
<code class="descclassname">sapphire.analysis.process_traces.</code><code class="descname">TRIGGER</code><em class="property"> = 600</em><a class="headerlink" href="#sapphire.analysis.process_traces.TRIGGER" title="Permalink to this definition">¶</a></dt>
<dd><p>Default trigger window, i.e. 1500 ns</p>
</dd></dl>

<dl class="data">
<dt id="sapphire.analysis.process_traces.POST_TRIGGER">
<code class="descclassname">sapphire.analysis.process_traces.</code><code class="descname">POST_TRIGGER</code><em class="property"> = 1400</em><a class="headerlink" href="#sapphire.analysis.process_traces.POST_TRIGGER" title="Permalink to this definition">¶</a></dt>
<dd><p>Default post trigger window, i.e. 3500 ns</p>
</dd></dl>

<dl class="data">
<dt id="sapphire.analysis.process_traces.ADC_FILTER_THRESHOLD">
<code class="descclassname">sapphire.analysis.process_traces.</code><code class="descname">ADC_FILTER_THRESHOLD</code><em class="property"> = 10</em><a class="headerlink" href="#sapphire.analysis.process_traces.ADC_FILTER_THRESHOLD" title="Permalink to this definition">¶</a></dt>
<dd><p>Default Mean filter threshold of -6 mV</p>
</dd></dl>

<dl class="data">
<dt id="sapphire.analysis.process_traces.ADC_BASELINE_THRESHOLD">
<code class="descclassname">sapphire.analysis.process_traces.</code><code class="descname">ADC_BASELINE_THRESHOLD</code><em class="property"> = 17</em><a class="headerlink" href="#sapphire.analysis.process_traces.ADC_BASELINE_THRESHOLD" title="Permalink to this definition">¶</a></dt>
<dd><p>Default Baseline threshold of -10 mV</p>
</dd></dl>

<dl class="data">
<dt id="sapphire.analysis.process_traces.ADC_LOW_THRESHOLD">
<code class="descclassname">sapphire.analysis.process_traces.</code><code class="descname">ADC_LOW_THRESHOLD</code><em class="property"> = 253</em><a class="headerlink" href="#sapphire.analysis.process_traces.ADC_LOW_THRESHOLD" title="Permalink to this definition">¶</a></dt>
<dd><p>Default low ADC threshold for HiSPARC II</p>
</dd></dl>

<dl class="data">
<dt id="sapphire.analysis.process_traces.ADC_HIGH_THRESHOLD">
<code class="descclassname">sapphire.analysis.process_traces.</code><code class="descname">ADC_HIGH_THRESHOLD</code><em class="property"> = 323</em><a class="headerlink" href="#sapphire.analysis.process_traces.ADC_HIGH_THRESHOLD" title="Permalink to this definition">¶</a></dt>
<dd><p>Default high ADC threshold for HiSPARC II</p>
</dd></dl>

<dl class="data">
<dt id="sapphire.analysis.process_traces.ADC_LOW_THRESHOLD_III">
<code class="descclassname">sapphire.analysis.process_traces.</code><code class="descname">ADC_LOW_THRESHOLD_III</code><em class="property"> = 82</em><a class="headerlink" href="#sapphire.analysis.process_traces.ADC_LOW_THRESHOLD_III" title="Permalink to this definition">¶</a></dt>
<dd><p>Default low ADC threshold for HiSPARC III</p>
</dd></dl>

<dl class="data">
<dt id="sapphire.analysis.process_traces.ADC_HIGH_THRESHOLD_III">
<code class="descclassname">sapphire.analysis.process_traces.</code><code class="descname">ADC_HIGH_THRESHOLD_III</code><em class="property"> = 150</em><a class="headerlink" href="#sapphire.analysis.process_traces.ADC_HIGH_THRESHOLD_III" title="Permalink to this definition">¶</a></dt>
<dd><p>Default high ADC threshold for HiSPARC III</p>
</dd></dl>

<dl class="class">
<dt id="sapphire.analysis.process_traces.TraceObservables">
<em class="property">class </em><code class="descclassname">sapphire.analysis.process_traces.</code><code class="descname">TraceObservables</code><span class="sig-paren">(</span><em>traces</em><span class="sig-paren">)</span><a class="headerlink" href="#sapphire.analysis.process_traces.TraceObservables" title="Permalink to this definition">¶</a></dt>
<dd><p>Reconstruct trace observables</p>
<p>If one wants to reconstruct trace observables from existing data some
caveats apply. If the station applied the Mean Filter the trace values
will no longer match the raw values used to determine the observables
on the station. Additionally, if data reduction was active the trace
may be missing samples without a significant signal, this complicates
the determination of the baseline. Moreover, data reduction uses the
ADC_BASELINE_THRESHOLD to determine what signals to keep, so tiny pulses
may be removed making it impossible to reconstruct tiny pulseheights.</p>
<p>The (default) value of ADC_BASELINE_THRESHOLD is different for the
HiSPARC DAQ prior to v4 and also for PySPARC. Those use 25 ADC as
threshold.</p>
<p>Each returned list contains at least 4 elements, if there are less than
4 traces the list is padded with the code for missing detectors: -1.</p>
<p>Initialize the class.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>traces</strong> &#8211; a NumPy array of traces, ordered such that the first
element is the first sample of each trace.</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="sapphire.analysis.process_traces.TraceObservables.baselines">
<code class="descname">baselines</code><a class="headerlink" href="#sapphire.analysis.process_traces.TraceObservables.baselines" title="Permalink to this definition">¶</a></dt>
<dd><p>Mean value of the first 50 samples of the trace</p>
<p>This does not perfectly match the implementation in the DAQ which
is more complicated, this does provide the correct value in most
cases, or is off by 1 in most other.</p>
<p>Usually this value is either around 200 or 30, depending on the used
version of the DAQ.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the baseline in ADC count.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="sapphire.analysis.process_traces.TraceObservables.std_dev">
<code class="descname">std_dev</code><a class="headerlink" href="#sapphire.analysis.process_traces.TraceObservables.std_dev" title="Permalink to this definition">¶</a></dt>
<dd><p>Standard deviation of the first 50 samples of the trace</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the standard deviation in milli ADC count.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="sapphire.analysis.process_traces.TraceObservables.pulseheights">
<code class="descname">pulseheights</code><a class="headerlink" href="#sapphire.analysis.process_traces.TraceObservables.pulseheights" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum peak to baseline value in trace</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the pulseheights in ADC count.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="sapphire.analysis.process_traces.TraceObservables.integrals">
<code class="descname">integrals</code><a class="headerlink" href="#sapphire.analysis.process_traces.TraceObservables.integrals" title="Permalink to this definition">¶</a></dt>
<dd><p>Integral of trace for all values over threshold</p>
<p>The threshold is defined by ADC_BASELINE_THRESHOLD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the pulse integral in ADC count * sample.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="sapphire.analysis.process_traces.TraceObservables.n_peaks">
<code class="descname">n_peaks</code><a class="headerlink" href="#sapphire.analysis.process_traces.TraceObservables.n_peaks" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of peaks in the trace</p>
<p>The peak threshold is defined by ADC_LOW_THRESHOLD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the pulse integral in ADC count * sample.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="sapphire.analysis.process_traces.MeanFilter">
<em class="property">class </em><code class="descclassname">sapphire.analysis.process_traces.</code><code class="descname">MeanFilter</code><span class="sig-paren">(</span><em>use_threshold=True</em>, <em>threshold=10</em><span class="sig-paren">)</span><a class="headerlink" href="#sapphire.analysis.process_traces.MeanFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Filter raw traces</p>
<p>This class replicates the behavior of the Mean_Filter.vi in the HiSPARC
DAQ. A sawtooth-like pattern may be visible in traces due to ADC
misalignment and the synchronization pulse (?). This filter removes such
small oscillations but keeps significant pulses.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is a destructive algorithm which removes important information
from the data.</p>
</div>
<p>Verified, by eye, with the LabView VI and Bachelor thesis Oostenbrugge2014.</p>
<p>Initialize the class.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>use_threshold</strong> &#8211; use a threshold when filtering traces.</li>
<li><strong>threshold</strong> &#8211; value of the threshold to use.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="sapphire.analysis.process_traces.MeanFilter.filter_traces">
<code class="descname">filter_traces</code><span class="sig-paren">(</span><em>raw_traces</em><span class="sig-paren">)</span><a class="headerlink" href="#sapphire.analysis.process_traces.MeanFilter.filter_traces" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply the mean filter to multiple traces</p>
</dd></dl>

<dl class="method">
<dt id="sapphire.analysis.process_traces.MeanFilter.filter_trace">
<code class="descname">filter_trace</code><span class="sig-paren">(</span><em>raw_trace</em><span class="sig-paren">)</span><a class="headerlink" href="#sapphire.analysis.process_traces.MeanFilter.filter_trace" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply the mean filter to a single trace</p>
<p>First separate the even and odd ADC traces, filter each separately.
Then recombine them and pass the entire trace through the filter.</p>
</dd></dl>

<dl class="method">
<dt id="sapphire.analysis.process_traces.MeanFilter.mean_filter_with_threshold">
<code class="descname">mean_filter_with_threshold</code><span class="sig-paren">(</span><em>trace</em><span class="sig-paren">)</span><a class="headerlink" href="#sapphire.analysis.process_traces.MeanFilter.mean_filter_with_threshold" title="Permalink to this definition">¶</a></dt>
<dd><p>The mean filter in case use_threshold is True</p>
</dd></dl>

<dl class="method">
<dt id="sapphire.analysis.process_traces.MeanFilter.mean_filter_without_threshold">
<code class="descname">mean_filter_without_threshold</code><span class="sig-paren">(</span><em>trace</em><span class="sig-paren">)</span><a class="headerlink" href="#sapphire.analysis.process_traces.MeanFilter.mean_filter_without_threshold" title="Permalink to this definition">¶</a></dt>
<dd><p>The mean filter in case use_threshold is False</p>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/header.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="process_events.html"
                        title="previous chapter">Processing of HiSPARC events</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="reconstructions.html"
                        title="next chapter">Reconstructions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/analysis/process_traces.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="reconstructions.html" title="Reconstructions"
             >next</a> |</li>
        <li class="right" >
          <a href="process_events.html" title="Processing of HiSPARC events"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">SAPPHiRE 1.0.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../sapphire.html" >SAPPHiRE Reference</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../analysis.html" >Data analysis</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2009-2015, David Fokkema, Arne de Laat.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.4.
    </div>
  </body>
</html>